MaRDA Metadata Extractors API
================================

.. toctree::
   :maxdepth: 3
   :caption: Autogenerated Docs
   :hidden:
   :glob:

   apidoc/marda_extractors_api


``marda_extractors_api`` package
--------------------------------

There is a draft Python 3.10 package presented under the ``./marda_extractors_api``
directory.
It has no non-optional dependencies and can be used to:

- query the `Extractors Registry <https://marda-registry.fly.dev/>`_ for extractors that support a given file type,
- install those extractors in a fresh Python virtual environment environment via ``pip``,
- invoke the extractor either in Python or at the CLI, producing Python objects or files on disk.

Installation
------------

.. code-block:: bash

   git clone git@github.com:marda-alliance/metadata_extractors_api.git
   cd metadata_extractors_api;
   pip install .

Usage
-----

Currently, you can use the ``extract`` function from the ``metadata_extractors_api`` inside your own Python code:

.. code-block:: python

   from marda_extractors_api import extract

   # extract(<input_type>, <input_path>)
   data = extract("./example.mpr",  "biologic-mpr")

This example will install the first compatible ``biologic-mpr`` extractor it finds in the registry into a fresh virtualenv, and then execute it on the file at ``example.mpr``.

By default, the ``extract`` function will attempt to use the extractor's Python-based invocation (i.e. the optional ``preferred_mode="python"`` argument is specified). This means the extractor will be executed from within python, and the returned ``data`` object will be a Python object as defined (and supported) by the extractor. This may require additional packages to be installed, for examples ``pandas`` or ``xarray``, which are both supported via the installation command ``pip install .[formats]`` above. If you encounter the following traceback, a missing "format" (such as ``xarray`` here) is the likely reason:

.. code-block:: python

   Traceback (most recent call last):
       [...]
       data = pickle.loads(shm.buf)
   ModuleNotFoundError: No module named 'xarray'

Alternatively, if the ``preferred_mode="cli"`` argument is specified, the extractor will be executed using its command-line invocation. This means the output of the extractor will most likely be a file, which can be further specified using the ``output_type`` argument:

.. code-block:: python

   from marda_extractors_api import extract
   ret = extract("example.mpr", "biologic-mpr", output_path="output.nc", preferred_mode = "cli")

In this case, the ``ret`` will be empty bytes, and the output of the extractor should appear in the ``output.nc`` file.


.. |MMESchemaRepo| image:: https://badgen.net/static/marda-alliance/metadata_extractors_schema/?icon=github

.. _MMESchemaRepo: https://github.com/marda-alliance/metadata_extractors_schema/

.. |MMERegistryRepo| image:: https://badgen.net/static/marda-alliance/metadata_extractors_registry/?icon=github

.. _MMERegistryRepo: https://github.com/marda-alliance/metadata_extractors_registry/

.. |MMEAPIRepo| image:: https://badgen.net/static/marda-alliance/metadata_extractors_api/?icon=github

.. _MMEAPIRepo: https://github.com/marda-alliance/metadata_extractors_api/

.. |LinkML| replace:: :mod:`LinkML`

.. _LinkML: https://linkml.io/linkml/

.. |FileType| replace:: :class:`FileType`

.. _FileType: mme_schema/FileType.html#class-filetype

.. |Extractor| replace:: :class:`Extractor`

.. _Extractor: mme_schema/Extractor.html#class-extractor
